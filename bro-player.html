<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="bower_components/paper-slider/paper-slider.html">


<dom-module id="bro-player">
    <template>
        <style>
            :host {
                display: inline-block;
                position: relative;
                overflow: hidden;
                line-height: 1.1;

                background-color: #000000;
                --foreground-color: #FFFFFF;
                --background-color: rgba(0,0,0,0.7);

                --display-playpause: block;
                --display-progress: block;
                --display-volume: block;
                --display-mute: block;
                --display-time: block;
                --display-fullscreen: block;
            }
            :host .bro-player-controls {
                background: var(--background-color);
                box-sizing: border-box;
                height: 60px;
                font-family: Arial, sans-serif;
                position: absolute;
                padding: 0;
                bottom: 0;
                width: 100%;
                left: 0;
                right: 0;
                opacity: 0;
                box-shadow: 0 0 10px rgba(0,0,0,0.3);
                -webkit-transition: opacity 0.3s ease-in;
                transition: opacity 0.3s ease-in;
                -moz-user-select: none;
                -webkit-user-select: none;
                user-select: none;
                z-index: 3;
                display: none;
            }
            :host .bro-player-controls.bro-player-controls-fullscreen {
                z-index: 2147483647;
                position: fixed;
            }
            :host .bro-player-controls.bro-player-progressbar-hidden {
                padding-top: 9px;
                height: 50px;
            }

            :host #bro-player-video {
                position: relative;
                display: none;
                z-index:2;
            }
            :host #bro-player-video::-webkit-media-controls-enclosure {
                display:none !important;
            }
            :host .bro-player-errors {
                font-family: Arial, sans-serif;
                width: 100%;
                color: #FFFFFF;
                position: absolute;
                top: 0;
                z-index: 1;
            }

            :host .bro-player-video:hover .bro-player-controls {
                opacity: 1;
            }

            :host .bro-player-controls .bro-player-progress {
                width: 100%;
                position: relative;
                margin: 0 0 0 0;
                display: var(--display-progress);
            }

            :host .bro-player-controls .bro-player-progress .bro-player-progress-bar {
                width: 100%;
                height: 20px;
            }

            :host .bro-player-controls .bro-player-row {
                margin: 0 3%;
            }

            :host .bro-player-controls .bro-player-play-pause {
                display: inline-block;
                color: var(--foreground-color);
                font-size: 29px;
                float: left;
                text-shadow: 0 0 0 var(--foreground-color);
                color: rgba(255,255,255,0.8);
                width: 40px;
                margin-right: 10px;
                padding: 0 0 0 0;
                cursor: pointer;
                font-variant: small-caps;
                display: var(--display-playpause);
            }

            :host .bro-player-controls .bro-player-play, :host .bro-player-controls .bro-player-pause-button {
                -webkit-transition: all 0.2s ease-out;
            }

            :host .bro-player-controls .bro-player-play .bro-player-pause-button, :host .bro-player-controls .bro-player-pause .bro-player-play-button {
                display: none;
            }

            :host .bro-player-controls .bro-player-pause-button {
                padding: 5px 2px;
                box-sizing: border-box;
                -moz-box-sizing: border-box;
                height: 34px;
            }

            :host .bro-player-controls .bro-player-pause-button span {
                background: var(--foreground-color);
                width: 8px;
                height: 24px;
                float: left;
                display: block;
            }

            :host .bro-player-controls .bro-player-pause-button span:first-of-type {
                margin: 0 4px 0 0;
            }

            :host .bro-player-controls .bro-player-time {
                color: var(--foreground-color);
                font-size: 16px;
                position: relative;
                float: left;
                margin-top: 8px;
                margin-bottom: 8px;
                margin-left: 10px;
                margin-right: 10px;
                min-width: 100px;
                overflow: hidden;
                display: var(--display-time);
            }

            :host .bro-player-controls .bro-player-play:hover {
                text-shadow: 0 0 5px var(--foreground-color);
            }

            :host .bro-player-controls .bro-player-play:active, :host .bro-player-pause-button:active span {
                text-shadow: 0 0 7px var(--foreground-color);
            }


            :host .bro-player-controls .bro-player-pause-button:hover span {
                box-shadow: 0 0 5px var(--foreground-color);
            }
            :host .bro-player-controls .bro-player-pause-button:active span {
                box-shadow: 0 0 7px var(--foreground-color);
            }


            :host .bro-player-controls .bro-player-volume {
                position: relative;
                float: left;
                width: 20%;
                min-width: 75px;
                height: 30px;
                display: var(--display-volume);
                margin-right: 10px;
            }

            :host .bro-player-controls .bro-player-volume-bar {
                width: 100%;
            }

            :host .bro-player-controls .bro-player-volume-icon {
                padding: 9px 0;
                height: 30px;
                cursor: pointer;
                box-sizing: border-box;
                -moz-box-sizing: border-box;
                -webkit-transition: all 0.15s linear;
                width: 40px;
                float: left;
                display: var(--display-mute);
            }
            :host .bro-player-controls .bro-player-volume-icon span {
                width: 12px;
                height: 10px;
                background-color: var(--foreground-color);
                display: block;
                position: relative;
                z-index: 1;
                font-weight: bold;
                color: var(--foreground-color);
                top: 2px;
                left: 0;
                font-size: 13px;
            }
            :host .bro-player-controls .bro-player-volume-icon:hover span,
            :host .bro-player-controls .bro-player-volume-icon:hover span:after
            {
                box-shadow: 0 0 5px var(--foreground-color);
            }

            :host .bro-player-controls .bro-player-volume-icon span:before,
            :host .bro-player-controls .bro-player-volume-icon span:after {
                content: '';
                position: absolute;
            }
            :host .bro-player-controls .bro-player-volume-icon span:before {
                width: 0;
                height: 0;
                border: 1em solid transparent;
                border-left: none;
                border-right-color: var(--foreground-color);
                z-index: 2;
                top: -2px;
                left: 1px;
                margin-top: -50%;
            }
            :host .bro-player-controls .bro-player-volume-icon span:after {
                width: 0;
                height: 0;
                border: 0;
                left: 18px;
                border-width: 0px 0px 0 0;
                top: 5px;
                border-radius: 0 50px 0 0;
                -webkit-transform: rotate(45deg);
                -moz-transform: rotate(45deg);
                -ms-transform: rotate(45deg);
                -o-transform: rotate(45deg);
                transform: rotate(45deg);
                font-variant: small-caps;
            }
            :host .bro-player-controls .bro-player-volume-icon.bro-player-volume-icon-on span:after {
                border: 5px solid var(--foreground-color) !important;
                top: 0;
            }

            :host .bro-player-controls .bro-player-fullscreen {
                margin-right: 5px;
                cursor: pointer;
                float: right;
                position: relative;
                display: var(--display-fullscreen);
            }

            :host .bro-player-controls .bro-player-fullscreen a {
                width: 25px;
                height: 20px;
                border-radius: 3px;
                background: var(--foreground-color);
                display: block;
                position: relative;
                margin: 5px auto;
            }
            :host .bro-player-title {
                width: 100%;
                padding: 15px;
                color: var(--title-foreground-color);
                box-sizing: border-box;
                font-family: Arial, sans-serif;
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                opacity: 0;
                -webkit-transition: opacity 0.3s ease-in;
                transition: opacity 0.3s ease-in;
                z-index: 5;
                display: none;
                background: -moz-linear-gradient(top, var(--title-background-color) 0%, var(--title-background-color-opacity-0) 100%); /* FF3.6-15 */
                background: -webkit-linear-gradient(top, var(--title-background-color) 0%,var(--title-background-color-opacity-0) 100%); /* Chrome10-25,Safari5.1-6 */
                background: linear-gradient(to bottom, var(--title-background-color) 0%,var(--title-background-color-opacity-0) 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
            }
            :host .bro-player-bigbutton {
                display: block;
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                width: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 4;
                cursor: pointer;
                display: none;
            }
            :host .bro-player-bigbutton .bro-player-play-button {
                color: #FFF;
                position: absolute;
                left: calc(50% - calc(50px / 2));
                top: calc(50% - calc(55px / 2));
                font-size: 50px;
                height: 55px;
                width: 50px;
            }
            :host .bro-player-bigbutton:hover .bro-player-play-button {
                text-shadow: 0 0 5px var(--foreground-color);
            }
            :host .hidden {
                display: none;
            }
            :host .opacity-100 {
                opacity: 1;
            }


        </style>
        <div class="bro-player-container">
            <video id="bro-player-video">
            </video>
            <slot></slot>
            <ul class="bro-player-errors">

            </ul>
            <div class="bro-player-title opacity-100"></div>
            <div class="bro-player-bigbutton">
                <div class="bro-player-play-button">&#9658;</div>
            </div>
            <div class="bro-player-controls opacity-100">
                <div class="bro-player-progress">
                    <paper-slider class="bro-player-progress-bar" secondary-progress="0"></paper-slider>
                </div>
                <div class="bro-player-row">
                    <div class="bro-player-fullscreen">
                        <a href="#"> </a>
                    </div>
                    <div class="bro-player-play-pause bro-player-play">
                        <span class="bro-player-play-button">&#9658;</span>
                        <div class="bro-player-pause-button">
                            <span> </span>
                            <span> </span>
                        </div>
                    </div>
                    <div class="bro-player-volume-icon bro-player-volume-icon-on">
                        <span></span>
                    </div>
                    <div class="bro-player-volume">
                        <paper-slider class="bro-player-volume-bar" min="0" max="1000" value="1000"></paper-slider>
                    </div>
                    <div class="bro-player-time">
                        <span class="bro-player-ctime">00:00</span>
                        <span class="bro-player-stime"> / </span>
                        <span class="bro-player-ttime">00:00</span>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <script>
        (function( global ) {

            var BroLib = function(elem){
                return new BroLib.init(elem);
            }

            var version = "0.0.1";

            var rnotwhite = ( /\S+/g ),
                rclass = /[\t\r\n\f]/g;

            BroLib.prototype = {
                addClass: function(value) {
                    var classes, cur, curValue, clazz, j, finalValue;

                    if ( typeof value === "string" && value ) {
                        classes = value.match( rnotwhite ) || [];

                        curValue = this.elem.getAttribute("class");
                        cur = this.elem.nodeType === 1 &&
                            ( " " + curValue + " " ).replace( rclass, " " );

                        if ( cur ) {
                            j = 0;
                            while ( ( clazz = classes[ j++ ] ) ) {
                                if ( cur.indexOf( " " + clazz + " " ) < 0 ) {
                                    cur += clazz + " ";
                                }
                            }

                            finalValue = cur.trim();
                            if ( curValue !== finalValue ) {
                                this.elem.setAttribute("class", finalValue );
                            }
                        }
                    }
                    
                    return this;
                },
                removeClass: function(value) {
                    var classes, cur, curValue, clazz, j, finalValue;

                    if ( typeof value === "string" && value ) {
                        classes = value.match( rnotwhite ) || [];
                        curValue = this.elem.getAttribute("class");

                        cur = this.elem.nodeType === 1 &&
                            ( " " + curValue + " " ).replace( rclass, " " );

                        if ( cur ) {
                            j = 0;
                            while ( ( clazz = classes[ j++ ] ) ) {

                                while ( cur.indexOf( " " + clazz + " " ) > -1 ) {
                                    cur = cur.replace( " " + clazz + " ", " " );
                                }
                            }

                            finalValue = cur.trim();
                            if ( curValue !== finalValue ) {
                                this.elem.setAttribute("class", finalValue );
                            }
                        }
                        
                    }

                    return this;
                },
                renderTime: function(currentTime, duration){

                    var seconds = 0,
                            minutes = Math.floor(currentTime / 60),
                            tminutes = Math.floor(duration / 60),
                            tseconds = Math.round((duration) - (tminutes*60));

                    if(currentTime) {
                        seconds = Math.round(currentTime) - (60*minutes);
                        if(seconds > 59) {
                            seconds = Math.round(currentTime) - (60*minutes);
                            if(seconds == 60) {
                                minutes = Math.round(currentTime / 60);
                                seconds = 0;
                            }
                        }
                    }
                    if(seconds < 10) { seconds = '0'+seconds; }
                    if(tseconds < 10) { tseconds = '0'+tseconds; }

                    return {
                        "minutes": minutes,
                        "tminutes": tminutes,
                        "seconds": seconds,
                        "tseconds": tseconds
                    };
                },
                isFullScreen: function(){
                    return (document.webkitIsFullScreen || document.mozFullScreen || document.fullScreen || document.msFullScreen);
                },
                convertHex: function(hex,opacity){

                    var r,g,b,result;

                    hex = hex.replace("#","");

                    if(hex.length == 3){
                        hex = hex+""+hex;
                    }
                    else if(hex.length == 6){}
                    else {
                        return "(0,0,0,"+opacity+")";
                    }

                    r = parseInt(hex.substring(0,2), 16);
                    g = parseInt(hex.substring(2,4), 16);
                    b = parseInt(hex.substring(4,6), 16);

                    result = 'rgba('+r+','+g+','+b+','+opacity+')';
                    return result;
                },
                convertDimensions: function(hash){
                    var value = "";
                    if(hash.substr(hash.length-1) == "%"){
                        value = parseInt(hash.substr(0,hash.length-1))+"%";
                    }
                    else if(hash == "auto"){
                        value = "auto";
                    }
                    else {
                        value = parseInt(hash)+"px";
                    }
                    return value;
                },
                stripTags: function(str){
                    return str.replace(/(<([^>]+)>)/ig,"");
                }
            };

            BroLib.init = function(elem){
                this.elem = elem;
            }

            BroLib.version = version;

            BroLib.init.prototype = BroLib.prototype;

            if(global.BroLib !== undefined){
				if(global.BroLib.version !== undefined) {
					if(global.BroLib.version < BroLib.version){
						global.BroLib = BroLib;
					}
				}
				else {
					global.BroLib = BroLib;
				}
            }
			else {
				global.BroLib = BroLib;
			}


        }(window));

        // Extend Polymer.Element base class
        class MyElement extends Polymer.Element {
            static get is() { return 'bro-player'; }
            static get config() {
                return { 
                    properties: {
                        src: {
                            type: String,
                            value: ""
                        },
                        title: {
                            type: String,
                            value: ""
                        },
                        height: {
                            type: String,
                            value: "auto"
                        },
                        width: {
                            type: String,
                            value: "100%"
                        },
                        autoplay: {
                            type: Boolean,
                            value: false
                        },
                        loop: {
                            type: Boolean,
                            value: false
                        },
                        titleBackgroundColor: {
                            type: String,
                            value: "000000"
                        },
                        titleForegroundColor: {
                            type: String,
                            value: "FFFFFF"
                        },
                        backgroundColor: {
                            type: String,
                            value: "000000"
                        },
                        backgroundOpacity: {
                            type: String,
                            value: "0.7"
                        },
                        foregroundColor: {
                            type: String,
                            value: "FFFFFF"
                        },
                        progressColor: {
                            type: String,
                            value: "#3367d6"
                        },
                        bufferColor: {
                            type: String,
                            value: "#7baaf7"
                        },
                        hidePlaypause: {
                            type: Boolean,
                            value: false
                        },
                        hideProgressbar: {
                            type: Boolean,
                            value: false
                        },
                        hideVolume: {
                            type: Boolean,
                            value: false
                        },
                        hideMute: {
                            type: Boolean,
                            value: false
                        },
                        hideTime: {
                            type: Boolean,
                            value: false
                        },
                        hideFullscreen: {
                            type: Boolean,
                            value: false
                        },
                        allowContextmenu: {
                            type: Boolean,
                            value: false
                        },
                        noVideo: {
                            type: String,
                            value: "Cannot open source"
                        }
                    }
                }
            }
            constructor() {
                super();
            }
            connectedCallback() {
                super.connectedCallback();
                this.initVariables();
                this.initSources();
                this.initProperties();
                this.initSections();
                this.initControls();
            }
            initVariables(){
                this.dom = {};
                this.dom.player = this.shadowRoot.querySelector(".bro-player-container");
                this.dom.video = this.shadowRoot.querySelector("#bro-player-video");
                this.dom.errors = this.shadowRoot.querySelector(".bro-player-errors");
                this.dom.title = this.shadowRoot.querySelector(".bro-player-title");

                this.dom.controls = {};
                this.dom.controls.container = this.shadowRoot.querySelector(".bro-player-controls");
                this.dom.controls.playButton = this.shadowRoot.querySelector(".bro-player-controls .bro-player-play-pause");
                this.dom.controls.progress = this.shadowRoot.querySelector(".bro-player-controls .bro-player-progress .bro-player-progress-bar");
                this.dom.controls.volume = this.shadowRoot.querySelector(".bro-player-controls .bro-player-volume .bro-player-volume-bar");
                this.dom.controls.muteButton = this.shadowRoot.querySelector(".bro-player-controls .bro-player-volume-icon");
                this.dom.controls.fullscreenButton = this.shadowRoot.querySelector(".bro-player-controls .bro-player-fullscreen a");
                this.dom.controls.bigButton = this.shadowRoot.querySelector(".bro-player-bigbutton");

                this.variables = {};
                this.variables.volume = this.dom.video.volume;
                this.variables.currentTime = 0;
                this.variables.progWidth = 0;
                this.variables.init = false;

            }
            initSources(){
                var content = this.shadowRoot.querySelector('slot').assignedNodes();
                for (var i = 0; i < content.length; i++) {
                    if (content[i].tagName === "SOURCE") {
                        this.dom.video.appendChild(content[i]);
                    }
                }
            }
            initProperties(){
                if(this.src.length > 0){
                    this.dom.video.setAttribute("src",BroLib().stripTags(this.src));
                }

                if(this.title.length > 0){
                    this.dom.title.innerHTML = BroLib().stripTags(this.title);
                }

                var width = BroLib().convertDimensions(this.width);
                var height = BroLib().convertDimensions(this.height);
                this.style.width = width;
                this.style.height = height;
                this.dom.video.setAttribute("width",width);
                this.dom.video.setAttribute("height",height);



                this.dom.video.autoplay = this.autoplay;
                if(this.autoplay){
                    BroLib(this.dom.controls.playButton).addClass('bro-player-pause').removeClass('bro-player-play');
                }
                this.dom.video.loop = this.loop;

                var titleBackgroundColor = BroLib().convertHex(this.titleBackgroundColor,1);
                this.updateStyles({'--title-background-color': titleBackgroundColor});

                var titleBackgroundColorOpacity0 = BroLib().convertHex(this.titleBackgroundColor,0);
                this.updateStyles({'--title-background-color-opacity-0': titleBackgroundColorOpacity0});

                var titleForegroundColor = BroLib().convertHex(this.titleForegroundColor,1);
                this.updateStyles({'--title-foreground-color': titleForegroundColor});

                var backgroundOpacity = parseFloat(this.backgroundOpacity);
                if(backgroundOpacity > 1) { backgroundOpacity = 1; }
                else if(backgroundOpacity < 0) { backgroundOpacity = 0; }

                var backgroundColor = BroLib().convertHex(this.backgroundColor,backgroundOpacity);
                this.updateStyles({'--background-color': backgroundColor});

                var foregroundColor = BroLib().convertHex(this.foregroundColor,1);
                this.updateStyles({'--foreground-color': foregroundColor});

                var progressColor = BroLib().convertHex(this.progressColor,1);
                this.updateStyles({'--paper-slider-active-color': progressColor});
                this.updateStyles({'--paper-slider-knob-color': progressColor});

                var bufferColor = BroLib().convertHex(this.bufferColor,1);
                this.updateStyles({'--paper-slider-secondary-color': bufferColor});
            }
            initSections(){
                if(this.hidePlaypause){
                    this.updateStyles({'--display-playpause': "none"});
                }

                if(this.hideProgressbar){
                    this.updateStyles({'--display-progress': "none"});
                    BroLib(this.dom.controls.container).addClass("progressbar-hidden");
                }

                if(this.hideVolume){
                    this.updateStyles({'--display-volume': "none"});
                }2

                if(this.hideMute){
                    this.updateStyles({'--display-mute': "none"});
                }

                if(this.hideTime){
                    this.updateStyles({'--display-time': "none"});
                }

                if(this.hideFullscreen){
                    this.updateStyles({'--display-fullscreen': "none"});
                }
            }
            initControls() {
                var self = this;

                // enable <video> if working source is available
                self.dom.video.addEventListener('canplay', function (e) {
                    if(!self.hideProgressbar) {
                        self.dom.controls.progress.max = self.dom.video.duration;
                        self.dom.controls.volume.value = self.dom.video.volume * 1000;
                    }

                    if(!self.init){
                        self.dom.video.style.display = "block";
                        self.dom.errors.style.display = "none";
                        self.dom.title.style.display = "block";
                        self.dom.controls.bigButton.style.display = "block";
                        self.init = true;
                    }
                    self.updateTime();
                });

                self.dom.controls.bigButton.addEventListener('click', function(e){
                    self.dom.controls.bigButton.style.display = "none";
                    self.dom.controls.container.style.display = "block";
                    self.playPause();
                });

                self.dom.video.addEventListener('error',function(e){
                    self.addError(this.src);
                });
                
                self.dom.video.querySelectorAll("source").forEach(function(source){
                    source.addEventListener('error',function(){
                        self.addError(this.src);
                    });
                });

                // Hide Controls on mouse out
                document.querySelectorAll("body, html").forEach(function(elem){
                    elem.addEventListener('mousemove',function(e){
                        if(BroLib().isFullScreen()){
                            self.dom.controls.container.addEventListener('mouseenter',function(e){
                                self.showHide(true);
                            });
                            self.dom.controls.container.addEventListener('mouseleave',function(e){
                                self.showHide(false);
                            });
                        }
                        else {
                            self.dom.player.addEventListener('mouseenter',function(e){
                                if (self.dom.video.currentTime > 0 && self.dom.video.paused == false && self.dom.video.ended == false) {
                                    self.showHide(true);
                                }
                            });
                            self.dom.player.addEventListener('mouseleave',function(e){
                                if (self.dom.video.currentTime > 0 && self.dom.video.paused == false && self.dom.video.ended == false) {
                                    self.showHide(false);
                                }
                            });
                        }
                    });
                });



                // Update Video Progress Bar and Time
                self.dom.video.addEventListener('timeupdate', function(e){

                    if(!self.hideProgressbar) {
                        self.dom.controls.progress.value = self.dom.video.currentTime;
                    }

                    self.updateTime();

                    if(self.dom.video.currentTime > 0 && self.dom.video.paused == false && self.dom.video.ended == false) {
                        self.bufferLength();
                    }
                });

                // Update Time on Progress Bar Click

                if(!self.hideProgressbar) {
                    self.dom.controls.progress.addEventListener("change", function () {
                        self.dom.video.currentTime = this.value;
                    });
                }


                // Update Volume on Progress Bar Click
                if(!self.hideVolume) {
                    self.dom.controls.volume.addEventListener("change", function () {
                        self.volumeChange(this.value);
                    });
                    self.dom.controls.volume.addEventListener("immediate-value-change", function () {
                        self.volumeChange(this.immediateValue);
                    });
                }

                // Toggle Mutebutton
                if(!self.hideMute) {
                    self.dom.controls.muteButton.addEventListener("click", function () {
                        if (self.dom.video.volume > 0) {
                            self.variables.storevol = self.dom.video.volume;
                            self.dom.video.volume = 0;
                            self.dom.controls.volume.value = 0;
                            BroLib(self.dom.controls.muteButton).removeClass("bro-player-volume-icon-on");
                        }
                        else {
                            if (self.variables.storevol == 0) {
                                self.variables.storevol = 1;
                            }
                            self.dom.video.volume = self.variables.storevol;
                            self.dom.controls.volume.value = self.variables.storevol * 1000;
                            BroLib(self.dom.controls.muteButton).addClass("bro-player-volume-icon-on");
                        }
                    });
                }

                // Toggle PlayButton when clicked on PlayButton
                if(!self.hidePlaypause) {
                    self.dom.controls.playButton.addEventListener("click", function () {
                        self.playPause();
                    });
                }

                // Toggle Playbutton when clicked on video
                self.dom.video.addEventListener("click", function () {
                    self.playPause();
                });

                // Check if fullscreen supported.
                if(!self.dom.video.requestFullscreen && !self.dom.video.mozRequestFullScreen && !self.dom.video.webkitRequestFullScreen && !self.dom.video.msRequestFullScreen) {
                    BroLib(self.dom.controls.fullscreenButton).addClass("hidden");
                }

                // Toogle FullscreenButton
                if(!self.hideFullscreen) {
                    self.dom.controls.fullscreenButton.addEventListener("click", function () {

                        if (!BroLib().isFullScreen()) {
                            if (self.dom.video.requestFullscreen) {
                                self.dom.video.requestFullscreen();
                            }

                            else if (self.dom.video.mozRequestFullScreen) {
                                self.dom.video.mozRequestFullScreen();
                            }

                            else if (self.dom.video.webkitRequestFullScreen) {
                                self.dom.video.webkitRequestFullScreen();
                            }

                            else if (self.dom.video.msRequestFullScreen) {
                                self.dom.video.msRequestFullScreen();
                            }
                            BroLib(self.dom.controls.container).addClass("bro-player-controls-fullscreen");
                        }
                        else {
                            if (document.cancelFullScreen) {
                                document.cancelFullScreen();
                            }

                            else if (document.mozCancelFullScreen) {
                                document.mozCancelFullScreen();
                            }

                            else if (document.webkitCancelFullScreen) {
                                document.webkitCancelFullScreen();
                            }

                            else if (document.msCancelFullScreen) {
                                document.msCancelFullScreen();
                            }
                            BroLib(self.dom.controls.container).removeClass("bro-player-controls-fullscreen");
                        }
                    });
                }

                self.dom.video.addEventListener('ended', function() {

                    self.variables.playing = false;
                    self.dom.video.currentTime = 0;
                    BroLib(self.dom.controls.playButton).addClass("bro-player-play").removeClass('bro-player-pause');
                    if (self.dom.controls.container.style.opacity === 0) {
                        BroLib(self.dom.controls.container).addClass("opacity-100");
                    }

                });

                // Prevent Context Menu
                if(!self.allowContextmenu) {
                    self.dom.video.addEventListener('contextmenu', function (e) {
                        e.preventDefault();
                        return false;
                    });
                }

            }
            showHide(show){
                if(show){
                    BroLib(this.dom.controls.container).addClass("opacity-100");
                    BroLib(this.dom.title).addClass("opacity-100");
                }
                else {
                    BroLib(this.dom.controls.container).removeClass("opacity-100");
                    BroLib(this.dom.title).removeClass("opacity-100");
                }
            }
            volumeChange(vol) {
                var self = this;

                self.dom.video.volume = vol/1000;
                if(self.dom.video.volume == 0){
                    self.removeClass(self.dom.controls.muteButton, "bro-player-volume-icon-on");
                }
                else {
                    BroLib(self.dom.controls.muteButton).addClass("bro-player-volume-icon-on");
                }
            }
            playPause(){
                var self = this;
                if (self.dom.video.currentTime > 0 && self.dom.video.paused == false && self.dom.video.ended == false) {
                    self.variables.playing = false;
                } else {
                    self.variables.playing = true;
                }

                if (self.variables.playing == false) {
                    self.dom.video.pause();
                    BroLib(self.dom.controls.playButton).addClass("bro-player-play").removeClass('bro-player-pause');
                } else {
                    self.variables.begin = true;
                    self.dom.video.play();
                    BroLib(self.dom.controls.playButton).addClass("bro-player-pause").removeClass('bro-player-play');
                }
            }
            bufferLength() {
                var self = this;

                if(!self.hideProgressbar) {
                    var buffered = self.dom.video.buffered;

                    if (buffered.length > 0) {

                        var i = buffered.length;

                        var maxBuffer = 0;

                        while (i--) {

                            if (buffered.start(i) <= self.dom.video.currentTime) {
                                if (buffered.end(i) > maxBuffer) {
                                    maxBuffer = buffered.end(i);
                                }
                            }
                        }
                        self.dom.controls.progress.secondaryProgress = maxBuffer;
                    }
                }
            }
            updateTime(){
                var self = this;

                if(!self.hideTime) {
                    var duration = self.dom.video.duration;
                    var currentTime = self.dom.video.currentTime;

                    var renderedTime = BroLib().renderTime(currentTime,duration);
                
                    self.dom.player.querySelector('.bro-player-ctime').innerHTML = renderedTime.minutes + ':' + renderedTime.seconds;
                    self.dom.player.querySelector('.bro-player-ttime').innerHTML = renderedTime.tminutes + ':' + renderedTime.tseconds;
                }
            }
            addError(src){
                var li = document.createElement("LI");
                li.innerHTML = this.noVideo+": "+src;
                this.dom.errors.appendChild(li);
            }
        }

        // Register custom element definition using standard platform API
        customElements.define(MyElement.is, MyElement);
    </script>

</dom-module>