<dom-module name="bro-player"><template><style>:host{display:inline-block;position:relative;background-color:#000000; --foreground-color:#FFFFFF; --background-color:rgba(0,0,0,0.7); --display-playpause:block; --display-progress:block; --display-volume:block; --display-mute:block; --display-time:block; --display-fullscreen:block;overflow:hidden;}:host .controls{background:var(--background-color);box-sizing:border-box;height:60px;float:left;font-family:Arial,sans-serif;position:absolute;padding:0;bottom:0;width:100%;left:0;right:0;opacity:1;box-shadow:0 0 10px rgba(0,0,0,0.3);-webkit-transition:opacity 0.3s ease-in;transition:opacity 0.3s ease-in;-moz-user-select:none;-webkit-user-select:none;user-select:none;z-index:3;display:none;}:host .controls.controls-fullscreen{z-index:2147483647;position:fixed;}:host .controls.progressbar-hidden{padding-top:9px;height:50px;}:host video{position:relative;display:none;z-index:2;}:host video::-webkit-media-controls-enclosure{display:none !important;}:host .errors{font-family:Arial,sans-serif;width:100%;color:#FFFFFF;position:absolute;top:0;z-index:1;}:host .video:hover .controls{opacity:1;}:host .controls .progress{width:100%;position:relative;margin:0 0 0 0;display:var(--display-progress);}:host .controls .progress .progress-bar{width:100%;height:20px;}:host .controls .row{margin:0 3%;}:host .controls .play-pause{display:inline-block;color:var(--foreground-color);font-size:1.8em;float:left;text-shadow:0 0 0 var(--foreground-color);color:rgba(255,255,255,0.8);width:40px;margin-right:10px;padding:0 0 0 0;cursor:pointer;font-variant:small-caps;display:var(--display-playpause);}:host .controls .play,:host .controls .pause-button{-webkit-transition:all 0.2s ease-out;}:host .controls .play .pause-button,:host .controls .pause .play-button{display:none;}:host .controls .pause-button{padding:5px 2px;box-sizing:border-box;-moz-box-sizing:border-box;height:34px;}:host .controls .pause-button span{background:var(--foreground-color);width:8px;height:24px;float:left;display:block;}:host .controls .pause-button span:first-of-type{margin:0 4px 0 0;}:host .controls .time{color:var(--foreground-color);font-size:1em;position:relative;float:left;margin-top:8px;margin-bottom:8px;margin-left:10px;margin-right:10px;min-width:100px;overflow:hidden;display:var(--display-time);}:host .controls .play:hover{text-shadow:0 0 5px var(--foreground-color);}:host .controls .play:active,:host .pause-button:active span{text-shadow:0 0 7px var(--foreground-color);}:host .controls .pause-button:hover span{box-shadow:0 0 5px var(--foreground-color);}:host .controls .pause-button:active span{box-shadow:0 0 7px var(--foreground-color);}:host .controls .volume{position:relative;float:left;width:20%;min-width:75px;height:30px;display:var(--display-volume);margin-right:10px;}:host .controls .volume-bar{width:100%;}:host .controls .volume-icon{padding:9px 0;height:30px;cursor:pointer;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-transition:all 0.15s linear;width:40px;float:left;display:var(--display-mute);}:host .controls .volume-icon span{width:12px;height:10px;background-color:var(--foreground-color);display:block;position:relative;z-index:1;font-weight:bold;color:var(--foreground-color);top:2px;left:0;font-size:13px;}:host .controls .volume-icon:hover span,:host .controls .volume-icon:hover span:after{box-shadow:0 0 5px var(--foreground-color);}:host .controls .volume-icon span:before,:host .controls .volume-icon span:after{content:'';position:absolute;}:host .controls .volume-icon span:before{width:0;height:0;border:1em solid transparent;border-left:none;border-right-color:var(--foreground-color);z-index:2;top:-2px;left:1px;margin-top:-50%;}:host .controls .volume-icon span:after{width:0;height:0;border:0;left:18px;border-width:0px 0px 0 0;top:5px;border-radius:0 50px 0 0;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(45deg);font-variant:small-caps;}:host .controls .volume-icon.volume-icon-on span:after{border:5px solid var(--foreground-color) !important;top:0;}:host .controls .fullscreen{margin-right:5px;cursor:pointer;float:right;position:relative;display:var(--display-fullscreen);}:host .controls .fullscreen a{width:25px;height:20px;border-radius:3px;background:var(--foreground-color);display:block;position:relative;margin:5px auto;}</style><div class="container"><video id="video"><content></content></video><ul class="errors"></ul><div class="controls"><div class="progress"><paper-slider class="progress-bar" secondary-progress="0"></paper-slider></div><div class="row"><div class="fullscreen"><a href="#"></a></div><div class="play-pause play"><span class="play-button">&#9658;</span><div class="pause-button"><span></span> <span></span></div></div><div class="volume-icon volume-icon-on"><span></span></div><div class="volume"><paper-slider class="volume-bar" min="0" max="1000" value="1000"></paper-slider></div><div class="time"><span class="ctime">00:00</span> <span class="stime">/</span> <span class="ttime">00:00</span></div></div></div></div></template><script>Polymer({is:"bro-player",properties:{src:{type:String,value:""},height:{type:String,value:"auto"},width:{type:String,value:"100%"},autoplay:{type:Boolean,value:!1},loop:{type:Boolean,value:!1},backgroundColor:{type:String,value:"000000"},backgroundOpacity:{type:String,value:"0.7"},foregroundColor:{type:String,value:"FFFFFF"},progressColor:{type:String,value:"#3367d6"},bufferColor:{type:String,value:"#7baaf7"},hidePlaypause:{type:Boolean,value:!1},hideProgressbar:{type:Boolean,value:!1},hideVolume:{type:Boolean,value:!1},hideMute:{type:Boolean,value:!1},hideTime:{type:Boolean,value:!1},hideFullscreen:{type:Boolean,value:!1},allowContextmenu:{type:Boolean,value:!1},noVideo:{type:String,value:"Cannot open source"}},variables:{storevol:0,playing:!1,begin:!1},attached:function(){this.initVariables(),this.initProperties(),this.initSections(),this.initControls()},initVariables:function(){this.player=Polymer.dom(this.root).querySelector(".container"),this.video=Polymer.dom(this.root).querySelector("video"),this.errors=Polymer.dom(this.root).querySelector(".errors"),this.controls={},this.controls.container=Polymer.dom(this.root).querySelector(".controls"),this.controls.playButton=Polymer.dom(this.root).querySelector(".controls .play-pause"),this.controls.progress=Polymer.dom(this.root).querySelector(".controls .progress .progress-bar"),this.controls.volume=Polymer.dom(this.root).querySelector(".controls .volume .volume-bar"),this.controls.muteButton=Polymer.dom(this.root).querySelector(".controls .volume-icon"),this.controls.fullscreenButton=Polymer.dom(this.root).querySelector(".controls .fullscreen a"),this.variables.volume=this.video.volume,this.variables.currentTime=0,this.variables.progWidth=0},initProperties:function(){this.src.length>0&&$(this.video).attr("src",this.src);var e=this.convertDimensions(this.width),o=this.convertDimensions(this.height);this.style.width=e,this.style.height=o,$(this.video).attr("width",e),$(this.video).attr("height",o),this.video.autoplay=this.autoplay,this.autoplay&&$(this.controls.playButton).addClass("pause").removeClass("play"),this.video.loop=this.loop;var t=parseFloat(this.backgroundOpacity);t>1?t=1:0>t&&(t=0);var r=this.convertHex(this.backgroundColor,t);this.customStyle["--background-color"]=r;var n=this.convertHex(this.foregroundColor,1);this.customStyle["--foreground-color"]=n;var s=this.convertHex(this.progressColor,1);this.customStyle["--paper-slider-active-color"]=s,this.customStyle["--paper-slider-knob-color"]=s;var i=this.convertHex(this.bufferColor,1);this.customStyle["--paper-slider-secondary-color"]=i,this.updateStyles()},convertHex:function(e,o){if(e=e.replace("#",""),3==e.length)e=e+""+e;else if(6!=e.length)return"(0,0,0,"+o+")";return r=parseInt(e.substring(0,2),16),g=parseInt(e.substring(2,4),16),b=parseInt(e.substring(4,6),16),result="rgba("+r+","+g+","+b+","+o+")",result},convertDimensions:function(e){var o="";return"%"==e.substr(e.length-1)?(console.log("1"),o=parseInt(e.substr(0,e.length-1))+"%"):"auto"==e?(console.log("2"),o="auto"):(console.log("3"),o=parseInt(e)+"px"),console.log("value is: "+o),o},initSections:function(){this.hidePlaypause&&(this.customStyle["--display-playpause"]="none"),this.hideProgressbar&&(this.customStyle["--display-progress"]="none",$(this.controls.container).addClass("progressbar-hidden")),this.hideVolume&&(this.customStyle["--display-volume"]="none"),this.hideMute&&(this.customStyle["--display-mute"]="none"),this.hideTime&&(this.customStyle["--display-time"]="none"),this.hideFullscreen&&(this.customStyle["--display-fullscreen"]="none"),this.updateStyles()},volumeChange:function(e){var o=this;o.video.volume=e/1e3,0==o.video.volume?$(o.controls.muteButton).removeClass("volume-icon-on"):$(o.controls.muteButton).addClass("volume-icon-on")},playPause:function(){var e=this;e.video.currentTime>0&&0==e.video.paused&&0==e.video.ended?e.variables.playing=!1:e.variables.playing=!0,0==e.variables.playing?(e.video.pause(),$(e.controls.playButton).addClass("play").removeClass("pause")):(e.variables.begin=!0,e.video.play(),$(e.controls.playButton).addClass("pause").removeClass("play"))},bufferLength:function(){var e=this;if(!e.hideProgressbar){var o=e.video.buffered;if(o.length>0){for(var t=o.length,r=0;t--;)o.start(t)<=e.video.currentTime&&o.end(t)>r&&(r=o.end(t));e.controls.progress.secondaryProgress=r}}},isFullScreen:function(){return document.webkitIsFullScreen||document.mozFullScreen||document.fullScreen||document.msFullScreen},addError:function(e){var o=$("<li></li>");o.text(this.noVideo+": "+e),$(this.errors).append(o)},initControls:function(){var e=this;e.hideProgressbar||e.video.addEventListener("canplay",function(){e.controls.progress.max=e.video.duration,e.controls.volume.value=1e3*e.video.volume}),$(e.video).on("canplay",function(){e.video.style.display="block",e.errors.style.display="none",e.controls.container.style.display="block"}),$(e.video).on("error",function(){e.addError(this.src)}),$(e.video).find("source").on("error",function(){e.addError(this.src)}),$("body, html").bind("mousemove",function(o){e.isFullScreen()?$(e.controls.container).hover(function(){0==$(e.controls.container).css("opacity")&&$(e.controls.container).stop(!0,!1).animate({opacity:"1"},.5)},function(){1==$(e.controls.container).css("opacity")&&$(e.controls.container).stop(!0,!1).animate({opacity:"0"},3)}):$(e.player).hover(function(){e.video.currentTime>0&&0==e.video.paused&&0==e.video.ended&&0==$(e.controls.container).css("opacity")&&$(e.controls.container).stop(!0,!1).animate({opacity:"1"},.5)},function(){e.video.currentTime>0&&0==e.video.paused&&0==e.video.ended&&1==$(e.controls.container).css("opacity")&&$(e.controls.container).stop(!0,!1).animate({opacity:"0"},.5)})}),e.video.addEventListener("timeupdate",function(){e.hideProgressbar||(e.controls.progress.value=e.video.currentTime);var o=e.video.duration,t=e.video.currentTime,r=0,n=Math.floor(t/60),s=Math.floor(o/60),i=Math.round(o-60*s);t&&(r=Math.round(t)-60*n,r>59&&(r=Math.round(t)-60*n,60==r&&(n=Math.round(t/60),r=0))),10>r&&(r="0"+r),10>i&&(i="0"+i),e.hideTime||($(e.player).find(".ctime").html(n+":"+r),$(e.player).find(".ttime").html(s+":"+i)),e.video.currentTime>0&&0==e.video.paused&&0==e.video.ended&&e.bufferLength()}),e.hideProgressbar||e.controls.progress.addEventListener("change",function(){e.video.currentTime=this.value}),e.hideVolume||(e.controls.volume.addEventListener("change",function(){e.volumeChange(this.value)}),e.controls.volume.addEventListener("immediate-value-change",function(){e.volumeChange(this.immediateValue)})),e.hideMute||e.controls.muteButton.addEventListener("click",function(){e.video.volume>0?(e.variables.storevol=e.video.volume,e.video.volume=0,e.controls.volume.value=0,$(e.controls.muteButton).removeClass("volume-icon-on")):(0==e.variables.storevol&&(e.variables.storevol=1),e.video.volume=e.variables.storevol,e.controls.volume.value=1e3*e.variables.storevol,$(e.controls.muteButton).addClass("volume-icon-on"))}),e.hidePlaypause||e.controls.playButton.addEventListener("click",function(){e.playPause()}),e.video.addEventListener("click",function(){e.playPause()}),e.video.requestFullscreen||e.video.mozRequestFullScreen||e.video.webkitRequestFullScreen||e.video.msRequestFullScreen||$(e.controls.fullscreenButton).hide(),e.hideFullscreen||e.controls.fullscreenButton.addEventListener("click",function(){e.isFullScreen()?(document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen(),$(e.controls.container).removeClass("controls-fullscreen")):(e.video.requestFullscreen?e.video.requestFullscreen():e.video.mozRequestFullScreen?e.video.mozRequestFullScreen():e.video.webkitRequestFullScreen?e.video.webkitRequestFullScreen():e.video.msRequestFullScreen&&e.video.msRequestFullScreen(),$(e.controls.container).addClass("controls-fullscreen"))}),e.video.addEventListener("ended",function(){e.variables.playing=!1,e.video.currentTime=0,$(e.controls.playButton).addClass("play").removeClass("pause"),0==$(e.controls.container).css("opacity")&&$(e.controls.container).stop(!0,!1).animate({opacity:"1"},.5)}),e.allowContextmenu||$(e.video).bind("contextmenu",function(){return!1})}});</script></dom-module>