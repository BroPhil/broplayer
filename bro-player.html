<dom-module name="bro-player"><template><style>:host{display:inline-block;position:relative; --foreground-color:#FFFFFF; --background-color:rgba(0,0,0,0.7); --display-playpause:block; --display-progress:block; --display-volume:block; --display-mute:block; --display-time:block; --display-fullscreen:block;}.controls{background:var(--background-color);box-sizing:border-box;height:60px;float:left;font-family:Arial,sans-serif;position:absolute;padding:0;bottom:0;width:100%;left:0;right:0;opacity:1;box-shadow:0 0 10px rgba(0,0,0,0.3);-webkit-transition:opacity 0.3s ease-in;transition:opacity 0.3s ease-in;-moz-user-select:none;-webkit-user-select:none;user-select:none;z-index:3;overflow:hidden;}.controls.controls-fullscreen{z-index:2147483647;position:fixed;}.controls.progressbar-hidden{padding-top:9px;height:50px;}video{position:relative;}video::-webkit-media-controls-enclosure{display:none !important;}.video:hover .controls{opacity:1;}.controls .progress{width:100%;position:relative;margin:0 0 0 0;display:var(--display-progress);}.controls .progress .progress-bar{width:100%;height:20px;}.controls .row{margin:0 3%;}.controls .play-pause{display:inline-block;color:var(--foreground-color);font-size:1.8em;float:left;text-shadow:0 0 0 var(--foreground-color);color:rgba(255,255,255,0.8);width:40px;margin-right:10px;padding:0 0 0 0;cursor:pointer;font-variant:small-caps;display:var(--display-playpause);}.controls .play,.controls .pause-button{-webkit-transition:all 0.2s ease-out;}.controls .play .pause-button,.controls .pause .play-button{display:none;}.controls .pause-button{padding:5px 2px;box-sizing:border-box;-moz-box-sizing:border-box;height:34px;}.controls .pause-button span{background:var(--foreground-color);width:8px;height:24px;float:left;display:block;}.controls .pause-button span:first-of-type{margin:0 4px 0 0;}.controls .time{color:var(--foreground-color);font-size:1em;position:relative;float:left;margin-top:8px;margin-bottom:8px;margin-left:10px;margin-right:10px;min-width:100px;overflow:hidden;display:var(--display-time);}.controls .play:hover{text-shadow:0 0 5px var(--foreground-color);}.controls .play:active,.pause-button:active span{text-shadow:0 0 7px var(--foreground-color);}.controls .pause-button:hover span{box-shadow:0 0 5px var(--foreground-color);}.controls .pause-button:active span{box-shadow:0 0 7px var(--foreground-color);}.controls .volume{position:relative;float:left;width:20%;min-width:75px;height:30px;display:var(--display-volume);margin-right:10px;}.controls .volume-bar{width:100%;}.controls .volume-icon{padding:9px 0;height:30px;cursor:pointer;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-transition:all 0.15s linear;width:40px;float:left;display:var(--display-mute);}.controls .volume-icon span{width:12px;height:10px;background-color:var(--foreground-color);display:block;position:relative;z-index:1;font-weight:bold;color:var(--foreground-color);top:2px;left:0;font-size:13px;}.controls .volume-icon:hover span,.controls .volume-icon:hover span:after{box-shadow:0 0 5px var(--foreground-color);}.controls .volume-icon span:before,.controls .volume-icon span:after{content:'';position:absolute;}.controls .volume-icon span:before{width:0;height:0;border:1em solid transparent;border-left:none;border-right-color:var(--foreground-color);z-index:2;top:-2px;left:1px;margin-top:-50%;}.controls .volume-icon span:after{width:0;height:0;border:0;left:18px;border-width:0px 0px 0 0;top:5px;border-radius:0 50px 0 0;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(45deg);font-variant:small-caps;}.controls .volume-icon.volume-icon-on span:after{border:5px solid var(--foreground-color) !important;top:0;}.controls .fullscreen{margin-right:5px;cursor:pointer;float:right;position:relative;display:var(--display-fullscreen);}.controls .fullscreen a{width:25px;height:20px;border-radius:3px;background:var(--foreground-color);display:block;position:relative;margin:5px auto;}</style><div class="container"><video src="{{src}}" width="{{width}}" height="{{height}}" id="video"><content></content></video><div class="controls"><div class="progress"><paper-slider class="progress-bar" secondary-progress="0"></paper-slider></div><div class="row"><div class="fullscreen"><a href="#"></a></div><div class="play-pause play"><span class="play-button">&#9658;</span><div class="pause-button"><span></span> <span></span></div></div><div class="volume-icon volume-icon-on"><span></span></div><div class="volume"><paper-slider class="volume-bar" min="0" max="1000" value="1000"></paper-slider></div><div class="time"><span class="ctime">00:00</span> <span class="stime">/</span> <span class="ttime">00:00</span></div></div></div></div></template><script>Polymer({is:"bro-player",properties:{src:String,height:Number,width:Number,backgroundColor:{type:String,value:"000000"},backgroundOpacity:{type:String,value:"0.7"},foregroundColor:{type:String,value:"FFFFFF"},progressColor:{type:String,value:"#3367d6"},bufferColor:{type:String,value:"#7baaf7"},hidePlaypause:{type:Boolean,value:!1},hideProgressbar:{type:Boolean,value:!1},hideVolume:{type:Boolean,value:!1},hideMute:{type:Boolean,value:!1},hideTime:{type:Boolean,value:!1},hideFullscreen:{type:Boolean,value:!1},allowContextmenu:{type:Boolean,value:!1}},variables:{storevol:0,playing:!1,begin:!1},attached:function(){this.initVariables(),this.initProperties(),this.initSections(),this.initControls()},initVariables:function(){this.player=Polymer.dom(this.root).querySelector(".container"),this.video=Polymer.dom(this.root).querySelector("video"),this.controls={},this.controls.container=Polymer.dom(this.root).querySelector(".controls"),this.controls.playButton=Polymer.dom(this.root).querySelector(".controls .play-pause"),this.controls.progress=Polymer.dom(this.root).querySelector(".controls .progress .progress-bar"),this.controls.volume=Polymer.dom(this.root).querySelector(".controls .volume .volume-bar"),this.controls.muteButton=Polymer.dom(this.root).querySelector(".controls .volume-icon"),this.controls.fullscreenButton=Polymer.dom(this.root).querySelector(".controls .fullscreen a"),this.variables.volume=this.video.volume,this.variables.currentTime=0,this.variables.progWidth=0},initProperties:function(){this.style.width=parseInt(this.width)+"px",this.style.height=parseInt(this.height)+"px";var e=parseFloat(this.backgroundOpacity);e>1?e=1:0>e&&(e=0);var o=this.convertHex(this.backgroundColor,e);this.customStyle["--background-color"]=o;var t=this.convertHex(this.foregroundColor,1);this.customStyle["--foreground-color"]=t;var n=this.convertHex(this.progressColor,1);this.customStyle["--paper-slider-active-color"]=n,this.customStyle["--paper-slider-knob-color"]=n;var r=this.convertHex(this.bufferColor,1);this.customStyle["--paper-slider-secondary-color"]=r,this.updateStyles()},convertHex:function(e,o){if(e=e.replace("#",""),3==e.length)e=e+""+e;else if(6!=e.length)return"(0,0,0,"+o+")";return r=parseInt(e.substring(0,2),16),g=parseInt(e.substring(2,4),16),b=parseInt(e.substring(4,6),16),result="rgba("+r+","+g+","+b+","+o+")",result},initSections:function(){this.hidePlaypause&&(this.customStyle["--display-playpause"]="none"),this.hideProgressbar&&(this.customStyle["--display-progress"]="none",$(this.controls.container).addClass("progressbar-hidden")),this.hideVolume&&(this.customStyle["--display-volume"]="none"),this.hideMute&&(this.customStyle["--display-mute"]="none"),this.hideTime&&(this.customStyle["--display-time"]="none"),this.hideFullscreen&&(this.customStyle["--display-fullscreen"]="none"),this.updateStyles()},volumeChange:function(e){var o=this;o.video.volume=e/1e3,0==o.video.volume?$(o.controls.muteButton).removeClass("volume-icon-on"):$(o.controls.muteButton).addClass("volume-icon-on")},playPause:function(){var e=this;e.video.currentTime>0&&0==e.video.paused&&0==e.video.ended?e.variables.playing=!1:e.variables.playing=!0,0==e.variables.playing?(e.video.pause(),$(e.controls.playButton).addClass("play").removeClass("pause")):(e.variables.begin=!0,e.video.play(),$(e.controls.playButton).addClass("pause").removeClass("play"))},bufferLength:function(){var e=this;if(!e.hideProgressbar){var o=e.video.buffered;if(o.length>0){for(var t=o.length,n=0;t--;)o.start(t)<=e.video.currentTime&&o.end(t)>n&&(n=o.end(t));e.controls.progress.secondaryProgress=n}}},isFullScreen:function(){return document.webkitIsFullScreen||document.mozFullScreen||document.fullScreen||document.msFullScreen},initControls:function(){var e=this;$("body, html").bind("mousemove",function(o){e.isFullScreen()?$(e.controls.container).hover(function(){0==$(e.controls.container).css("opacity")&&$(e.controls.container).stop(!0,!1).animate({opacity:"1"},.5)},function(){1==$(e.controls.container).css("opacity")&&$(e.controls.container).stop(!0,!1).animate({opacity:"0"},3)}):$(e.player).hover(function(){e.video.currentTime>0&&0==e.video.paused&&0==e.video.ended&&0==$(e.controls.container).css("opacity")&&$(e.controls.container).stop(!0,!1).animate({opacity:"1"},.5)},function(){e.video.currentTime>0&&0==e.video.paused&&0==e.video.ended&&1==$(e.controls.container).css("opacity")&&$(e.controls.container).stop(!0,!1).animate({opacity:"0"},.5)})}),e.hideProgressbar||e.video.addEventListener("canplay",function(){e.controls.progress.max=e.video.duration,e.controls.volume.value=1e3*e.video.volume}),e.video.addEventListener("timeupdate",function(){e.hideProgressbar||(e.controls.progress.value=e.video.currentTime);var o=e.video.duration,t=e.video.currentTime,n=0,r=Math.floor(t/60),l=Math.floor(o/60),i=Math.round(o-60*l);t&&(n=Math.round(t)-60*r,n>59&&(n=Math.round(t)-60*r,60==n&&(r=Math.round(t/60),n=0))),10>n&&(n="0"+n),10>i&&(i="0"+i),e.hideTime||($(e.player).find(".ctime").html(r+":"+n),$(e.player).find(".ttime").html(l+":"+i)),e.video.currentTime>0&&0==e.video.paused&&0==e.video.ended&&e.bufferLength()}),e.hideProgressbar||e.controls.progress.addEventListener("change",function(){e.video.currentTime=this.value}),e.hideVolume||(e.controls.volume.addEventListener("change",function(){e.volumeChange(this.value)}),e.controls.volume.addEventListener("immediate-value-change",function(){e.volumeChange(this.immediateValue)})),e.hideMute||e.controls.muteButton.addEventListener("click",function(){e.video.volume>0?(e.variables.storevol=e.video.volume,e.video.volume=0,e.controls.volume.value=0,$(e.controls.muteButton).removeClass("volume-icon-on")):(0==e.variables.storevol&&(e.variables.storevol=1),e.video.volume=e.variables.storevol,e.controls.volume.value=1e3*e.variables.storevol,$(e.controls.muteButton).addClass("volume-icon-on"))}),e.hidePlaypause||e.controls.playButton.addEventListener("click",function(){e.playPause()}),e.video.addEventListener("click",function(){e.playPause()}),e.video.requestFullscreen||e.video.mozRequestFullScreen||e.video.webkitRequestFullScreen||e.video.msRequestFullScreen||$(e.controls.fullscreenButton).hide(),e.hideFullscreen||e.controls.fullscreenButton.addEventListener("click",function(){e.isFullScreen()?(document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen(),$(e.controls.container).removeClass("controls-fullscreen")):(e.video.requestFullscreen?e.video.requestFullscreen():e.video.mozRequestFullScreen?e.video.mozRequestFullScreen():e.video.webkitRequestFullScreen?e.video.webkitRequestFullScreen():e.video.msRequestFullScreen&&e.video.msRequestFullScreen(),$(e.controls.container).addClass("controls-fullscreen"))}),e.video.addEventListener("ended",function(){e.variables.playing=!1,e.video.currentTime=0,$(e.controls.playButton).addClass("play").removeClass("pause"),0==$(e.controls.container).css("opacity")&&$(e.controls.container).stop(!0,!1).animate({opacity:"1"},.5)}),e.allowContextmenu||$(e.video).bind("contextmenu",function(){return!1})}});</script></dom-module>